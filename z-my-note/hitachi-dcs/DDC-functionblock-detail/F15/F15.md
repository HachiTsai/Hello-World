# F15-アナログ積算器

**概要**

下面我會用 Python 讀取你上傳的 PDF（已讀取），並以程式化的方式整理該「功能塊（analog2.pdf）/ 章節（2.1 SLC-DDC L-制御）」的架構與使用規則。最後會以清單與資料結構（字典）輸出，方便你直接在程式中使用或再加工。

我會：

1. 用自然語言（繁體中文）說明功能塊的主要欄位、參數與作用。  
2. 提供一段 Python 程式（可直接執行）來從已解析的文字抽出重點欄位並輸出結構化資料（字典 / JSON）。  
3. 列出使用規則與參數範圍、注意事項與範例說明（簡單例子引導理解）。

---

## 1) 功能塊主要架構與欄位（依 PDF 內容萃取）

以下為從 PDF 片段整理出來的功能塊主要欄位與用途（以繁體中文說明）：

- 模塊名稱 / 類別
  - SLC-DDC（L-制御）：看起來是類似 DDC／控制器內的運算塊 / 算術塊（analog/算術處理）。

- 主要輸入/輸出與運算元
  - ASUM（瞬時值）: 單位時間內之量變換、累加或瞬時加總
  - Z1, Z2: 啟動指令或條件旗標（如 Z1 起動、Z2 >0 等判斷）
  - OUTA: 輸出端（1語長或2語長輸出）
  - Si：週期（週期時間）
  - CD：單位指定／時間單位選擇（%/秒、%/分、%/時、%/日）
  - BT（設定值 / 暫存字長）: 設定值，並與小數點位置、字長關聯
  - BIAS：增益/偏移或縮放用的常數
  - K：輸出變換係數（0.000～1.000 範圍）

- 參數說明（摘要）
  - 單位 / 時間單位（CD）：可指定 0~3 (或 4~7) 對應 %/秒、%/分、%/時、%/日（實際單位表在頁中）
  - 算力定數 C：取值範圍 -0.100 ~ 1.100（或相關範圍）
  - BIAS：整數設定（-3~3? 或 3~3 數值位置，PDF 片段有些不完整）
  - 設定值（BT）：小數點位置可設定（0~999999）
  - 出力變換係數 K：0.000 ~ 1.000（控制算值到輸出之比例）
  - 語長說明：2語長或1語長，內部表示範圍（1語長最大值 32000 提到）

- 運算關係與例子（PDF 範例）
  - Y = K * Δ（或 Y = K·△，代表輸出Y為變化量乘以係數K）
  - 若算值範圍與顯示單位不同，須用 BIAS 與 K 及 BT 做縮放與小數位調整
  - 範例：若量測 0～200.0 m 顯示，K=1 表示 0~2000（或依語長放大），K=0.10 則 0~200 輸出等（PDF 片段提例）

- 注意或補充
  - 當使用負數或需減算情形，要指定單位與減算邏輯（PDF 有註明負數減算）
  - 係數與小數點位置需同步設定，否則顯示/輸出會錯位
  - 1語長與2語長的換算（2語長可表示較大範圍，1語長上限32000）

---

## 2) 使用規則（重點、參數範圍與建議）

- **時間單位（CD）選擇**
  - CD = 0 或 4: %/秒
  - CD = 1 或 5: %/分（乘 60）
  - CD = 2 或 6: %/時（乘 3600）
  - CD = 3 或 7: %/日（乘 3600*24）
  - *說明*: 選擇時間單位會影響算力常數與輸出尺度（必須搭配算定常數C與K）

- **算力常數 C**
  - 範圍大概 -0.100 ~ 1.100（PDF 片段）
  - 若不指定，預設可能依 CD 或其它參數而定

- **BIAS（位移/縮放）**
  - 用來調整小數點顯示與單位倍率（例：若顯示需要 0.01 單位，要把 BIAS 設為對應倍數）

- **BT（設定值）**
  - 指定顯示或運算時的小數點位置與整數範圍（可設定 0~999999）
  - BT 與語長、BIAS 結合決定最終顯示

- **K（輸出變換係數）**
  - 範圍 0.000 ~ 1.000（PDF 提及此範圍）
  - 用於把內部算值換算為輸出尺度（例如變成實際工程單位）

- **語長（1語長、2語長）**
  - 1語長上限 32000（PDF 提到 1語長縮用 32000）
  - 若需要更大動態範圍，使用 2語長表示

- **輸出端（OUTA）與訊號目的地**
  - OUTA 可設定為輸出到特定端子或 SLCN 信號
  - 確認輸出格式（1語長或2語長）並配合接收端需求

---

## 3) 範例（簡單實務示範）

假設你有一個流量計量器，量測範圍 0～1000.00 m3（顯示需到小數點兩位），時間單位為 %/時（CD=2），要把算值轉成輸出並顯示：

- 設定：
  - CD = 2 (%/時)
  - BIAS = 2（代表 0.01 單位）
  - BT = 1000（代表小數點位置或放大因子）
  - K = 0.01（把2語長算值轉成1語長顯示倍率）
- 運算：
  - 內部算值（2語長）乘以 K 再加上 BIAS 對應的偏移，輸出到 OUTA

簡單口訣：單位尺度（CD）+ 顯示倍率（BIAS/BT）+ K（輸出係數）三者要相互對齊，才能正確顯示與控制。

---

## 4) 可執行的 Python 範例程式

下面提供一段 Python 程式，該程式將使用我們已解析的 PDF 文字（已由系統 reader 取得），並嘗試以規則化字典結構輸出欄位與範圍。你可以直接在本機執行或在 notebook 中跑。

```python
# analog_block_parser.py
# 範例：將解析後的文字做結構化（示範用）
pdf_text = """
（此處請貼從 reader 取得的完整文字）
"""

# 我們根據已閱讀內容手動定義欄位與推論的範圍
analog_block = {
    "name": "SLC-DDC (L-制御)",
    "fields": {
        "ASUM": {"desc": "瞬時值/單位時間累加或變換"},
        "Z1": {"desc": "啟動指令旗標"},
        "Z2": {"desc": "條件判斷 (例如 Z2 > 0)"},
        "OUTA": {"desc": "輸出端 (1語長或2語長)"},
        "Si": {"desc": "周期 (以時間為單位)"},
        "CD": {
            "desc": "時間單位選擇",
            "values": {
                "0/4": "%/秒",
                "1/5": "%/分",
                "2/6": "%/時",
                "3/7": "%/日"
            }
        },
        "BT": {"desc": "設定值/小數點位置", "range": "0 ~ 999999 (依實機限制)"},
        "BIAS": {"desc": "顯示倍率或偏移調整", "notes": "與小數位一起使用"},
        "K": {"desc": "出力變換係數", "range": "0.000 ~ 1.000"},
        "C": {"desc": "算力定數", "range": "-0.100 ~ 1.100 (PDF 片段)"},
        "word_length": {"desc": "語長 (1語長/2語長)", "notes": "1語長上限 ~32000"}
    },
    "remarks": [
        "Y = K * Δ (輸出為變化量乘以K)",
        "BIAS/BT/K 需搭配以正確顯示小數與單位",
        "選擇語長決定可表達的範圍"
    ]
}

import json
print(json.dumps(analog_block, ensure_ascii=False, indent=2))
```

說明：

- 這段程式並未直接從 PDF 做複雜的 NLP 擷取（已由 reader 取得文字片段並人工檢核），但輸出格式可直接保存為 JSON 作後續參數驗證或 GUI 使用。
- 若你需要，我可以幫你把 PDF 全文更自動化解析成規則化欄位（例如用 regex 或更複雜的解析器）並產生 CSV/JSON 檔案。

---

## 5) 我可以幫你做的進階項目（你可以選）

- 幫你把整份 PDF 全文自動解析成結構化 JSON（欄位、範圍、使用說明、範例），並提供下載檔案。  
- 為這個功能塊製作一個簡單的驗證腳本（Python），輸入實際參數會回傳是否合規（例如 K 範圍檢查、CD 與 BT 是否匹配等）。  
- 根據你要整合的 DCS/PLC 平台（例如某品牌 SLC 或顯示系統），把欄位映射成可匯入的參數表格（CSV）。

---

如果你想：  

- 我可以直接把 reader 得到的完整文字自動轉成更完整的結構化 JSON（需要你允許我用程式化方式處理完整文字），或  
- 你想針對某個欄位（例如 K、BT、BIAS）要範例計算或驗證器，我可以立刻幫你產生可執行的 Python 驗證程式。  
